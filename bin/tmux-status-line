#!/bin/sh

#load-average
line="${line}#[bold][#[default]#[fg=blue] $(uptime | awk '{print $(NF-2)}') #[default]#[bold]]#[default]"


#ssid
airport_path="/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport"
if air_info=($(eval "$airport_path" -I | grep -E "^ *(state|SSID):" | awk '{print $2}')) ; then
  case "${air_info[0]}" in
    "running" ) str="#[fg=colour014]${air_info[1]}#[default]" ;; 
    "init"    ) str="#[fg=yellow]...#[default]" ;;
    *         ) str="#[fg=red]✘#[default]" ;;
  esac  
  line="${line}#[bold][#[default] $str #[bold]]#[default]"
fi


#sound-volume
if sound_info=$(osascript -e 'get volume settings') ; then
  if [ "$(echo $sound_info | awk '{print $8}')" = "muted:false" ]; then
    sound_volume=$(expr $(echo $sound_info | awk '{print $2}' | sed "s/[^0-9]//g") / 6 )
    i=0
    str=""
    while [ $i -lt $sound_volume ]; do
      i=$(( i + 1 ))
      str="${str}="
    done
    while [ $i -lt 16 ]; do
      i=$(( i + 1 ))
      str="${str} "
    done
    line="${line}#[bold][$str]#[default] "
  else
    line="${line}#[bold][      mute      ]#[default] "
  fi
fi


#battery
if battery=$(/usr/bin/pmset -g ps | awk '{ if (NR == 2) print $2 " " $3 }' | sed -e "s/;//g" -e "s/%//") ; then
  battery_quantity=$(echo $battery | awk '{print $1}')
  if [[ ! $battery =~ "discharging" ]]; then
    line="${line}#[bg=cyan,fg=black] ⚡ $battery_quantity% #[default]"
  elif [ $battery_quantity -le 15 ]; then
    line="${line}#[bg=red,fg=white] $battery_quantity% #[default]"
  else
    line="${line}#[bg=cyan,fg=black] $battery_quantity% #[default]"
  fi
fi

echo "$line"
